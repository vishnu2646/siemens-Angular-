(function(n){function r(n){n.find(".fs-option.hl").removeClass("hl");n.find(".fs-search input").focus();window.fSelect.idx=-1}function u(n){var t=n.find(".fs-options"),f=n.find(".fs-option.hl"),r=f.offset().top+t.scrollTop(),e=r+f.outerHeight(),u=t.offset().top+t.scrollTop(),o=u+t.outerHeight(),i;e>o?(i=t.scrollTop()+e-o,t.scrollTop(i)):r<u&&(i=t.scrollTop()-u-r,t.scrollTop(i))}function f(n){window.fSelect.active_el=n;window.fSelect.active_id=n.data("id");window.fSelect.initial_values=n.find("select").val();n.find(".fs-dropdown").removeClass("hidden");n.addClass("fs-open");r(n)}function t(t){if("undefined"==typeof t&&null!=window.fSelect.active_el&&(t=window.fSelect.active_el),"undefined"!=typeof t){var i=window.fSelect.initial_values,r=t.find("select").val();JSON.stringify(i)!=JSON.stringify(r)&&n(document).trigger("fs:closed",t)}n(".fs-wrap").removeClass("fs-open");n(".fs-dropdown").addClass("hidden");window.fSelect.active_el=null;window.fSelect.active_id=null;window.fSelect.last_choice=null}function e(n,t){var i;typeof Event=="function"?i=new Event(t,{bubbles:!0}):(i=document.createEvent("Event"),i.initEvent(t,!0,!0));i.target=n;n.dispatchEvent(i)}n.fn.fSelect=function(t){function r(t,i){this.$select=n(t);this.settings=i;this.create()}var i;return i="string"==typeof t?t:n.extend({placeholder:"Select some options",numDisplayed:3,overflowText:"{n} selected",searchText:"Search",showSearch:!0,optionFormatter:!1},t),r.prototype={create:function(){this.settings.multiple=this.$select.is("[multiple]");var n=this.settings.multiple?" multiple":"";this.$select.wrap('<div class="fs-wrap'+n+'" tabindex="0" />');this.$select.before('<div class="fs-label-wrap"><div class="fs-label">'+this.settings.placeholder+'<\/div><span class="fs-arrow"><\/span><\/div>');this.$select.before('<div class="fs-dropdown hidden"><div class="fs-options"><\/div><\/div>');this.$select.addClass("hidden");this.$wrap=this.$select.closest(".fs-wrap");this.$wrap.data("id",window.fSelect.num_items);window.fSelect.num_items++;this.reload()},reload:function(){var n,t;this.settings.showSearch&&(n='<div class="fs-search"><input type="search" placeholder="'+this.settings.searchText+'" /><\/div>',this.$wrap.find(".fs-dropdown").prepend(n));this.idx=0;this.optgroup=0;this.selected=[].concat(this.$select.val());t=this.buildOptions(this.$select);this.$wrap.find(".fs-options").html(t);this.reloadDropdownLabel()},destroy:function(){this.$wrap.find(".fs-label-wrap").remove();this.$wrap.find(".fs-dropdown").remove();this.$select.unwrap().removeClass("hidden")},buildOptions:function(t){var i=this,r="";return t.children().each(function(t,u){var f=n(u),e;if("optgroup"==f.prop("nodeName").toLowerCase())r+='<div class="fs-optgroup-label" data-group="'+i.optgroup+'">'+f.prop("label")+"<\/div>",r+=i.buildOptions(f),i.optgroup++;else if(e=f.prop("value"),0<i.idx||""!=e||!i.settings.multiple){var s=f.is(":disabled")?" disabled":"",h=-1<n.inArray(e,i.selected)?" selected":"",c=" g"+i.optgroup,o='<div class="fs-option'+h+s+c+'" data-value="'+e+'" data-index="'+i.idx+'"><span class="fs-checkbox"><i><\/i><\/span><div class="fs-option-label">'+f.html()+"<\/div><\/div>";"function"==typeof i.settings.optionFormatter&&(o=i.settings.optionFormatter(o));r+=o;i.idx++}}),r},reloadDropdownLabel:function(){var i=this.settings,t=[];this.$wrap.find(".fs-option.selected").each(function(i,r){t.push(n(r).find(".fs-option-label").text())});t=t.length<1?i.placeholder:t.length>i.numDisplayed?i.overflowText.replace("{n}",t.length):t.join(", ");this.$wrap.find(".fs-label").html(t);this.$wrap.toggleClass("fs-default",t===i.placeholder);e(this.$select.get(0),"change")}},this.each(function(){var t=n(this).data("fSelect");t||(t=new r(this,i),n(this).data("fSelect",t));"string"==typeof i&&t[i]()})};window.fSelect={num_items:0,active_id:null,active_el:null,last_choice:null,idx:-1};n(document).on("click",".fs-option:not(.hidden, .disabled)",function(r){var u=n(this).closest(".fs-wrap"),e=!1,f;if(u.hasClass("multiple")){if(f=[],r.shiftKey&&null!=window.fSelect.last_choice){var o=parseInt(n(this).attr("data-index")),s=!n(this).hasClass("selected"),h=Math.min(window.fSelect.last_choice,o),c=Math.max(window.fSelect.last_choice,o);for(i=h;i<=c;i++)u.find(".fs-option[data-index="+i+"]").not(".hidden, .disabled").each(function(){n(this).toggleClass("selected",s)})}else window.fSelect.last_choice=parseInt(n(this).attr("data-index")),n(this).toggleClass("selected");u.find(".fs-option.selected").each(function(t,i){f.push(n(i).attr("data-value"))})}else f=n(this).attr("data-value"),u.find(".fs-option").removeClass("selected"),n(this).addClass("selected"),e=!0;u.find("select").val(f);u.find("select").fSelect("reloadDropdownLabel");n(document).trigger("fs:changed",u);e&&t(u)});n(document).on("keyup",".fs-search input",function(t){if(40==t.which){n(this).blur();return}var i=n(this).closest(".fs-wrap"),u=n(this).val().replace(/[|\\{}()[\]^$+*?.]/g,"\\$&");i.find(".fs-option, .fs-optgroup-label").removeClass("hidden");""!=u&&(i.find(".fs-option").each(function(){var t=new RegExp(u,"gi");null===n(this).find(".fs-option-label").text().match(t)&&n(this).addClass("hidden")}),i.find(".fs-optgroup-label").each(function(){var t=n(this).attr("data-group"),i=n(this).closest(".fs-options").find(".fs-option.g"+t+":not(.hidden)").length;i<1&&n(this).addClass("hidden")}));r(i)});n(document).on("click",function(i){var u=n(i.target),r=u.closest(".fs-wrap"),e;0<r.length?(r.data("id")!==window.fSelect.active_id&&t(),(u.hasClass("fs-label")||u.hasClass("fs-arrow"))&&(e=r.find(".fs-dropdown").hasClass("hidden"),e?f(r):t(r))):t()});n(document).on("keydown",function(i){var r=window.fSelect.active_el,e=n(i.target),o,f,s;if(e.hasClass("fs-wrap")){if(32==i.which){e.find(".fs-label").trigger("click");return}}else if(0<e.closest(".fs-search").length){if(32==i.which)return}else if(null===r)return;38==i.which?(i.preventDefault(),r.find(".fs-option.hl").removeClass("hl"),f=r.find(".fs-option[data-index="+window.fSelect.idx+"]"),o=f.prevAll(".fs-option:not(.hidden, .disabled)"),o.length>0?(window.fSelect.idx=parseInt(o.attr("data-index")),r.find(".fs-option[data-index="+window.fSelect.idx+"]").addClass("hl"),u(r)):(window.fSelect.idx=-1,r.find(".fs-search input").focus())):40==i.which?(i.preventDefault(),f=r.find(".fs-option[data-index="+window.fSelect.idx+"]"),s=f.length<1?r.find(".fs-option:not(.hidden, .disabled):first"):f.nextAll(".fs-option:not(.hidden, .disabled)"),s.length>0&&(window.fSelect.idx=parseInt(s.attr("data-index")),r.find(".fs-option.hl").removeClass("hl"),r.find(".fs-option[data-index="+window.fSelect.idx+"]").addClass("hl"),u(r))):32==i.which||13==i.which?(i.preventDefault(),r.find(".fs-option.hl").click()):27==i.which&&t(r)})})(jQuery)