var TemplateV4=function(){var i=function(){function n(){this._list=[]}return n.prototype.observe=function(n){this._list.push(n)},n.prototype.hasObserver=function(n){return this._list.contains(n)},n.prototype.unobserve=function(n){return this._list.contains(n)?(this._list.remove(n),!0):!1},n.prototype.notify=function(n){for(var i,r=!1,u=Array.prototype.slice.call(arguments,1),t=0,e=this._list.length;t<e;t++)try{if(this._list[t][n])r?this._list[t][n].apply(null,u):(i=this._list[t][n].apply(null,u),r=!0);else continue}catch(f){f.topic=n;console.log(f)}return i},n}(),n=function(){return this.pathfinder=function(n,t,i){var u=n.indexOf(".")>-1?n.split("."):[n],i=i||null,r;for(i||(i=t),r=0;r<u.length;r++)i=u[r]==="$root"?this.parent.data.constructor===Array?[].extendWith(this.parent.data):{}.extendWith(this.parent.data):i[u[r]]===undefined?null:i[u[r]];return i},this.IdGenerator=function(){return{next:{name:"auto-generated-template-id",value:performance.now()*Math.random()}}},this},t=function(r,u,f,e){return this.isBinded=!1,this.uniqueIdentifier=n().IdGenerator().next,this.parent=null,this.children=[],this.helpers=n,this.settings={subject:new i,bindings:{priority:["auto-generated-template-id","observe","if","html-placeholder","repeat","text","bind","set-value","dropdown-set-selected","generate-anchor","text-placeholder","construct-attributes","format-date","go-back","close-message-bar","bind-error","bind-text"],supported:{"auto-generated-template-id":{name:"auto-generated-template-id",execute:function(n){return n.getAttribute(this.uniqueIdentifier.name)==this.uniqueIdentifier.value}},observe:{name:"observe",execute:function(n,t){var i=n.getAttribute("observe"),r=i.indexOf(",")>-1?i.split(",").map(function(n){return n.trim()}):[i.trim()];r.forEach(function(i){var u=i.split(":"),r=u[0].toLowerCase().trim(),r=r.indexOf("on")===0?r.replace("on",""):r,f=u[1].trim();r&&f&&n.addEventListener(r,function(i){return this.settings.subject.notify(f,{element:n,data:t,event:i,context:this})}.bind(this))}.bind(this))}},"if":{name:"if",execute:function(t,i){var u=t.getAttribute("if").split(",").map(function(n){return n.trim()}),r=u.every(function(r){var u=r,f=u.indexOf("!")===0,u=f?u.slice(1):u,e=n.call(this).pathfinder(u,i),o=f?!Object.hasValue(e):Object.hasValue(e);return o===!1&&(t.style.display="none"),o}.bind(this));return r&&t.classList.add("tpl-visible"),r}},"html-placeholder":{name:"html-placeholder",execute:function(t,i){var r=t.getAttribute("html-placeholder").trim().split(",").map(function(t){return n.call(this).pathfinder(t.trim(),i)}.bind(this));t.appendChild(document.fragmentFromString(String.prototype.format.apply(r.first(),r.slice(1))))}},text:{name:"text",execute:function(t,i){var u=t.getAttribute("text"),r=n.call(this).pathfinder(u,i),r=r?r:r===0?"0":r===!1?"false":"";t.insertBefore(document.createTextNode((r+"").htmlDecode()),Array.prototype.first.call(t.childNodes))}},bind:{name:"bind",execute:function(t,i){(function(t,i){var r=t.getAttribute("bind"),o=r.indexOf("$root.")==0,r=o?r.replace("$root.",""):r,i=o?this.parent.data:i,e=n.call(this).pathfinder(r,i),u=new ObservableObject(i,r),f=function(n){return n.split(".").last()||n||""},s=function(t,i){var r=t.split("."),o="",u="",e=null;return r.last()&&(o=f(t),u=r.length<=1?t:r.slice(0,-1).join("."),e=n.call(this).pathfinder(u,i,i)),e},h;(e||e==="")&&this.ready().then(function(n,t){n.setValue(t)}.bind(this,t,e));u.onChange(function(n){if(t.bindingDirection=="data")t.bindingDirection=null;else{var e=s(r,n);t.setValue(e[f(r)]||e);this.settings.subject.notify("binding-update",{element:t,data:i,event:null,context:this,observable:u,newValue:e[f(r)]})}}.bind(this));h=[],function(){var n=function(n){var t=f(r)==r,e=t?u.value:s(r,u.value);return e[f(r)]=n.target.getValue(),n.target.bindingDirection="data",this.settings.subject.notify("binding-update",{element:n.target,data:i,event:n,context:this,observable:u,newValue:n.target.getValue()})}.bind(this);["input","change","cut","copy","paste"].forEach(function(i){t.addEventListener(i,n)}.bind(this))}.call(this)}).call(this,t,i)}},repeat:{name:"repeat",execute:function(i,r){var f=i.getAttribute("repeat").indexOf(",")>-1?i.getAttribute("repeat").split(",").map(function(n){return n.trim()}):[i.getAttribute("repeat").trim()],u=n.call(this).pathfinder(f[0],r),e=f[1]?!1:!0,s=e?i:document.querySelector(f[1]).cloneNode(!0),h=e?i.parentNode:i,c,o,l;if(h.removeAttribute("repeat"),s.removeAttribute("repeat"),s.removeAttribute("if"),!u)throw new Error(["repeat ",f[0],"Data-attribute value is incorrect. Binding data not fount!"]);if(u.length===0){i.style.display="none";return}for(c=document.createDocumentFragment(),o=e?1:0,l=u.length;o<l;o++)(function(n,i,r,u){r.appendChild(n);var f=new t(n,i,u.settings,u);u.children.push(f);window.setTimeout(function(){f.bindTemplate()},0)})(s.cloneNode(!0),u[o],c,this,h);return h.appendChild(c),e&&function(n){var r=new t(i,u[0],n.settings,n);r.parent=n;n.children.push(r);r.bindTemplate()}(this),!1}},"set-value":{name:"set-value",execute:function(t,i){var u=t.getAttribute("set-value").trim(),f=u.indexOf("!")===0?!0:!1,u=f?u.slice(1):u,r=n.call(this).pathfinder(u,i),r=r===null||r===undefined?"":r;f?f&&(t.setValue(!r),t.setAttribute("value",!r)):(t.setValue(r),t.setAttribute("value",r))}},"dropdown-set-selected":{name:"dropdown-set-selected",execute:function(t,i){var r=t.getAttribute("dropdown-set-selected").split(",").map(function(t){return n.call(this).pathfinder(t.trim(),i)}.bind(this));r[0]==r[1]&&t.setAttribute("selected",!0)}},"generate-anchor":{name:"generate-anchor",execute:function(t,i){var r=t.getAttribute("generate-anchor"),u=r.trim().split(",").map(function(t){return n.call(this).pathfinder(t.trim(),i)}.bind(this));t.setAttribute("href",String.prototype.format.apply(t.getAttribute("href"),u))}},"text-placeholder":{name:"text-placeholder",execute:function(t,i){var r=t.getAttribute("text-placeholder").split(",").map(function(t){return n.call(this).pathfinder(t.trim(),i)}.bind(this)),f=r.first(),u=r.slice(1),u=u.map(function(n){return(n+"").htmlDecode()});t.textContent=String.prototype.format.apply(f,u)}},"construct-attributes":{name:"construct-attributes",execute:function(t,i){var r=t.getAttribute("construct-attributes").split(",").map(function(n){return n.trim()});r.forEach(function(r){var u=r.split(":").map(function(n){return n.trim()}),o=u.first(),f,e;u.shift();f=u.first();u.shift();e=u.slice(0).map(function(t){return n.call(this).pathfinder(t.trim(),i)}.bind(this));t.setAttribute(o,e.length>0?String.prototype.format.apply(f,e):f)})}},"format-date":{name:"format-date",execute:function(t,i){var r=t.getAttribute("format-date").trim(),u=r.indexOf(",")>-1?r.indexOf(","):-1,f=u>0?r.slice(0,u):r,e=u>0?JSON.parse(r.slice(u+1).trim()):null,o=n.call(this).pathfinder(f.trim(),i);t.textContent=DateUtils.Format.fromISOString(o,e).date}},"go-back":{name:"go-back",execute:function(n){n.addEventListener("click",function(){return history.go(-1),!1})}},"close-message-bar":{name:"close-message-bar",execute:function(n){n.addEventListener("click",function(t){n.parentElement.classList.add("hide");t.preventDefault();t.stopPropagation()})}},"bind-error":{name:"bind-error",execute:function(n,t){(function(n,t){var i=n.getAttribute("bind-error"),r=function(){var r=this.helpers.call(this).pathfinder(i,t,t);r?(n.textContent=r.htmlEncode(),n.classList.remove("hide"),n.previousElementSibling&&n.previousElementSibling.classList&&n.previousElementSibling.classList.add("error")):(n.textContent="",n.classList.add("hide"),n.previousElementSibling&&n.previousElementSibling.classList&&n.previousElementSibling.classList.remove("error"))}.bind(this),u=new ObservableObject(t,i).onChange(r);r()}).call(this,n,t)}},"bind-text":{name:"bind-text",execute:function(n,t){(function(n,t){var i=n.getAttribute("bind-text"),r=function(){var r=this.helpers.call(this).pathfinder(i,t,t);n.textContent=(r||"").toString().htmlEncode()}.bind(this);r();new ObservableObject(this.data,i).onChange(r)}).call(this,n,t)}}}}},this.initialize=function(n,t,i,r){this.tpl=n.isHtmlElement()?n:document.querySelector(n);this.tpl.setAttribute(this.uniqueIdentifier.name,this.uniqueIdentifier.value);this.tpl.hasAttribute("smooth-show-hide")&&this.tpl.classList.add("hidden");this.tplCopy=this.tpl.cloneNode(!0);this.data=t;this.settings.extendWith(i||{});this.parent=r||null;this.children=[]},this.initialize(r,u,f,e),this};return t.prototype={constructor:t,bindTemplate:function(n){if(this.isBinded)return this.tpl;this.ready().then(function(){this.tpl.hasAttribute("smooth-show-hide")&&this.tpl.classList.remove("hidden")}.bind(this));var i=function(n){var i=[],t=!1;return Array.prototype.every.call(n.attributes,function(n){n.nodeName===this.uniqueIdentifier.name&&n.value===this.uniqueIdentifier.value&&(t=!0);t||n.nodeName!=="repeat"||(t=!0);var r=this.settings.bindings.priority.indexOf(n.nodeName);return r>-1&&i.push({priority:r,binding:this.settings.bindings.supported[n.nodeName]}),!t}.bind(this)),i.sort(function(n,t){return n.priority-t.priority}).every(function(i){var r=i.binding.execute.call(this,n,this.data);return r===!1?(t=!0,r):!0}.bind(this)),!t}.bind(this),t=function(n){if(n){if(!i(n))return;n.children.length>0&&Array.prototype.forEach.call(n.children,function(n){t(n)}.bind(this))}}.bind(this);return t(this.tpl),n&&this.ready().then(n.bind(this,this.tpl)),this.isBinded=!0,this},addExtension:function(n,t){if(!n.name||typeof n.name!="string")throw new Error(["binding.name should be of type String"]);if((t|0)!=t&&(t=this.settings.bindings.priority.length),!n.execute||n.execute.constructor!==Function)throw new Error(["binding.execute should be function: function (element, data) { //implementation }"]);this.settings.bindings.supported[n.name]={name:n.name,execute:n.execute};var i=this.settings.bindings.priority.preciseIndexOf(n.name);return i>-1&&this.settings.bindings.priority.splice(i,1),this.settings.bindings.priority.splice(t,0,n.name),this},reset:function(){var n,t;if(!this.isBinded)return this;if(n=this.tpl.parentNode,n){this.isBinded=!1;this.children=[];t=null;Array.prototype.every.call(n.childNodes,function(n,i){var r=n&&n.getAttribute&&n.getAttribute(this.uniqueIdentifier.name)==this.uniqueIdentifier.value;return r?(t=i,!1):!0}.bind(this));this.children.forEach(function(n){n.reset()});var u=n.childNodes.length-1===t,i=t===0,r=t<n.childNodes.length;n.removeChild(this.tpl);i&&r?n.insertBefore(this.tplCopy,n.childNodes[t]):u||i&&!r?n.appendChild(this.tplCopy):t>0&&t<n.childNodes.length-1?n.insertBefore(this.tplCopy,n.childNodes[t]):n.appendChild(this.tplCopy);this.initialize(this.tplCopy,this.data,this.settings,this.parent)}return this},addObserver:function(n){return this.settings.subject.hasObserver(n)?console.error("the same object is already added as observer",n):this.settings.subject.observe(n),this},ready:function(n){var t=new $.Deferred,n=n||1e4,i=window.setTimeout(function(){t.reject.call(this);window.clearInterval(i);window.clearInterval(r)}.bind(this),n),r=window.setInterval(function(){var n=this.children.filter(function(n){if(n.isBinded)return n}).length;n==this.children.length&&this.isBinded&&(t.resolve.call(this),window.clearInterval(i),window.clearInterval(r))}.bind(this),10);return t.promise(this)},rebind:function(n,t,i){return t=typeof t!=typeof function(){}?function(){}:t,n=n||this.data,i=i===!1?!1:!0,this.reset(),this.data=i?n.constructor===Array?[].extendWith(n):{}.extendWith(n):n,this.bindTemplate(t),this}},t}()